/*!---------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
"use strict";
var electron_1 = require("electron");
var Constants_1 = require("./Constants");
var advanced_1 = require("report-errors/advanced");
var error_reporter_base_1 = require("report-errors/error-reporter-base");
var ErrorHandlerRenderer = (function () {
    function ErrorHandlerRenderer() {
        var _this = this;
        advanced_1.setStackTraceLimit(Infinity);
        electron_1.ipcRenderer.send(Constants_1.ERROR_HANDLER_CHILD_INIT_IPC);
        process.on("uncaughtException", function (err) { return _this.handleUncaught(err, error_reporter_base_1.ErrorType.Exception); });
        process.on("unhandledRejection", function (err) { return _this.handleUncaught(err, error_reporter_base_1.ErrorType.Rejection); });
    }
    ErrorHandlerRenderer.prototype.handleUncaught = function (err, errorType) {
        var newError = advanced_1.coerceToError(err, errorType);
        var errTemp = { name: newError.name, message: newError.message, stack: newError.stack };
        var errorString = JSON.stringify(errTemp);
        electron_1.ipcRenderer.send(Constants_1.ERROR_HANDLER_CHILD_PROCESS_CRASHED_IPC, errorString, error_reporter_base_1.ErrorType[errorType]);
    };
    return ErrorHandlerRenderer;
}());
exports.ErrorHandlerRenderer = ErrorHandlerRenderer;
