/*---------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
"use strict";
/**
 * YieldIO scheduler schedules actions using setImmediate method
 * (https://nodejs.org/api/timers.html#timers_setimmediate_callback_arg)
 */
var YieldIOScheduler = (function () {
    function YieldIOScheduler() {
        this._completionPromise = Promise.resolve(null);
        this._isDisposed = false;
    }
    /**
     * Schedule action to execute on the next event queue processing after IO events.
     * @param action Action to execute
     */
    YieldIOScheduler.prototype.schedule = function (action) {
        if (!this._isDisposed) {
            var immediate = function () { return new Promise(function (resolve, reject) { return setImmediate(function () {
                action();
                resolve();
            }); }); };
            this._completionPromise = this._completionPromise.then(immediate);
        }
    };
    /**
     * Return promise which will be resolved when all actions are executed.
     * And do not accept new schedule events.
     */
    YieldIOScheduler.prototype.dispose = function () {
        this._isDisposed = true;
        return this._completionPromise;
    };
    return YieldIOScheduler;
}());
exports.YieldIOScheduler = YieldIOScheduler;
